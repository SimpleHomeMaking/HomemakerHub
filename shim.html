
<!-- saved from url=(0132)blob:https://38tq180towmu5u05a92062idizduhbaj0ljqktowxfkmb36z2x-h763805538.scf.usercontent.goog/6146d02a-88b7-4014-a755-b73343d954ee -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImY2ZTAxMDEwMWQ1NmE1NmIyZDY4Y2U3NDZkNmI5YzJlMmFlYzU5ZGQiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6XC9cL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwvZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxMDk4NzY3MDUyNTg0MTczNDAxOSIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJleHAiOjE3NDg2NDQxNTUsImlhdCI6MTc0ODY0MDU1NSwiYWxnIjoiUlMyNTYifQ.jlgJr48qht1is04cZp7bxaw1zjlSnr9RKpm03ppfu1OwckwBmS-yT5xKeZP-ePH_0qKUCmrggsG847h_wImoffgW8WZ9BqGWTjfZX32kYXW-ViuaDtDbcXvHkLJskja-NhQ_vMfrja1e8pTfo5hj8qbLHJ3vp_q9pU8od4q6LxmhQbUBsjiFiecmCHAP-9PYxaLnUC27uXZ_st8NfShNoj9nrpBiSoJAiQ8Er3rmv70HdLUg_MyuXNi7X86yxpCxuDrFitu1Ui6TL6UZgCky1zUn0KiquXZJocZaBbE09vWbl9zocgTbb_BoSyl2_ZSj5-cz6XTpP8YdeM71aWUE9g","c_391f07002b1a0c03_recipe-calendar-spa-749")</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  let originalGetUserMedia = realOriginalGetUserMedia;

  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          const mediaPromiseId = nextMediaPromiseId++;
          const promise = new Promise((resolve, reject) => {
            pendingMediaResolvers[mediaPromiseId] = (granted) => {
              delete pendingMediaResolvers[mediaPromiseId];
              if (granted) {
                if (originalGetUserMedia) {
                  originalGetUserMedia(constraints).then(resolve).catch(reject);
                } else {
                  reject(new Error("Original getUserMedia not available."));
                }
              } else {
              reject(new DOMException('Permission denied', 'NotAllowedError'));
            }
          };
        });

        window.parent.postMessage({
          type: 'requestMediaPermission',
          constraints: constraints,
          promiseId: mediaPromiseId,
        }, '*');

        return promise;
      },
      writable: false,
      configurable: false
    });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>(function() {
  const originalFetch = window.fetch;
  const googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict',
    'https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/veo-2.0-generate-001:predict',
    'https://generativelanguage.googleapis.com/v1beta/models/veo-2.0-generate-001:predictLongRunning',
  ];

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: 'models/' + modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

})();</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Recipe Calendar</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffe4e6; /* Default background */
            color: #333333; /* Default text color */
        }
        .container {
            max-width: 1200px; /* Increased max-width for better layout on larger screens */
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 0.5rem;
        }
        .calendar-day {
            min-height: 180px;
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .calendar-day.current-month {
            background-color: #fcfcfc;
        }
        .day-number {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            font-size: 0.95rem;
            font-weight: 700;
            color: #4a5568;
        }
        .meal-slot {
            width: 100%;
            text-align: center;
            padding: 0.6rem 0.8rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            margin-top: 0.4rem;
            font-weight: 500;
        }
        .meal-slot.breakfast { background-color: #ffe4e6; color: #be185d; margin-top: 1.5rem; }
        .meal-slot.lunch { background-color: #e0f2fe; color: #0284c7; }
        .meal-slot.dinner { background-color: #ede9fe; color: #7c3aed; }
        .meal-slot:hover { opacity: 0.9; transform: translateY(-1px); }

        .grocery-list-link {
            width: 100%;
            text-align: center;
            padding: 0.4rem 0.6rem;
            margin-top: 0.6rem;
            background-color: #facc15;
            color: #a16207;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .grocery-list-link:hover {
            background-color: #eab308;
            transform: translateY(-1px);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            max-width: 650px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.8rem;
            font-weight: bold;
            color: #9ca3af;
            cursor: pointer;
        }
        .close-button:hover {
            color: #4b5563;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #14b8a6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .category-heading {
            font-weight: 700;
            color: #0d9488;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid #ccfbf1;
            padding-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .section-heading {
            color: #0d9488;
        }
        .main-button {
            background-color: #14b8a6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .main-button:hover {
            background-color: #0d9488;
            transform: translateY(-1px);
        }
        .secondary-button {
            background-color: #6366f1;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        .secondary-button:hover {
            background-color: #4f46e5;
        }
        .checkbox-label {
            color: #0d9488;
        }
        #statusMessage {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #4a5568;
            text-align: center;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.relative{position:relative}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-top:0.5rem;margin-bottom:0.5rem}.mb-1{margin-bottom:0.25rem}.mb-10{margin-bottom:2.5rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mr-2{margin-right:0.5rem}.mr-3{margin-right:0.75rem}.mt-1{margin-top:0.25rem}.mt-16{margin-top:4rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.hidden{display:none}.h-4{height:1rem}.w-24{width:6rem}.w-28{width:7rem}.w-4{width:1rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-md{max-width:28rem}.max-w-xl{max-width:36rem}.list-disc{list-style-type:disc}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.rounded{border-radius:0.25rem}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-blue-200{--tw-border-opacity:1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-emerald-200{--tw-border-opacity:1;border-color:rgb(167 243 208 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-orange-200{--tw-border-opacity:1;border-color:rgb(254 215 170 / var(--tw-border-opacity, 1))}.bg-amber-50{--tw-bg-opacity:1;background-color:rgb(255 251 235 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-emerald-50{--tw-bg-opacity:1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-orange-50{--tw-bg-opacity:1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}.bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.bg-orange-600{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.p-2\.5{padding:0.625rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-2{padding:0.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.pl-5{padding-left:1.25rem}.pl-6{padding-left:1.5rem}.pt-8{padding-top:2rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.leading-relaxed{line-height:1.625}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-emerald-700{--tw-text-opacity:1;color:rgb(4 120 87 / var(--tw-text-opacity, 1))}.text-emerald-800{--tw-text-opacity:1;color:rgb(6 95 70 / var(--tw-text-opacity, 1))}.text-neutral-500{--tw-text-opacity:1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.text-neutral-600{--tw-text-opacity:1;color:rgb(82 82 82 / var(--tw-text-opacity, 1))}.text-neutral-700{--tw-text-opacity:1;color:rgb(64 64 64 / var(--tw-text-opacity, 1))}.text-neutral-800{--tw-text-opacity:1;color:rgb(38 38 38 / var(--tw-text-opacity, 1))}.text-orange-700{--tw-text-opacity:1;color:rgb(194 65 12 / var(--tw-text-opacity, 1))}.text-orange-800{--tw-text-opacity:1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-teal-600{--tw-text-opacity:1;color:rgb(13 148 136 / var(--tw-text-opacity, 1))}.text-teal-700{--tw-text-opacity:1;color:rgb(15 118 110 / var(--tw-text-opacity, 1))}.text-teal-800{--tw-text-opacity:1;color:rgb(17 94 89 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-200{transition-duration:200ms}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-600:hover{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-700:hover{--tw-bg-opacity:1;background-color:rgb(194 65 12 / var(--tw-bg-opacity, 1))}.focus\:border-transparent:focus{border-color:transparent}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-red-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(239 68 68 / var(--tw-ring-opacity, 1))}.focus\:ring-teal-400:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(45 212 191 / var(--tw-ring-opacity, 1))}.focus\:ring-teal-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(20 184 166 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:p-6{padding:1.5rem}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}.sm\:text-5xl{font-size:3rem;line-height:1}}@media (min-width: 1024px){.lg\:p-8{padding:2rem}}</style></head>
<body class="bg-amber-50 text-neutral-800">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-teal-700 mb-3">Family Recipe Calendar</h1>
            <p class="text-neutral-600 text-lg leading-relaxed max-w-2xl mx-auto">
                Tired of meal planning stress and endless grocery lists? Unlock effortless family meals and smart shopping with our interactive calendar!
                Plan, customize, and generate grocery lists with ease, all powered by intelligent AI suggestions.
                <br class="my-2">
                <span class="font-bold text-teal-700 text-xl">Simplify your kitchen and discover delicious new recipes!</span>
            </p>
            <div class="flex justify-center flex-wrap gap-4 mt-4">
                <button id="bookmarkCalendarBtn" class="main-button text-sm px-4 py-2">Add Calendar to Your Favorites and Bookmark</button>
                <button id="whatCanIMakeBtn" class="main-button text-sm px-4 py-2">✨ What Can I Make?</button>
            </div>
        </header>

        <main id="recipe-calendar">
            <section class="mb-10 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold section-heading mb-6 text-center">Your Monthly Meal Plan</h2>
                <p class="text-neutral-600 mb-8 text-center max-w-xl mx-auto">Navigate through months to see your daily meal plan. Click on any meal to view its recipe, adjust servings, or generate a grocery list for the week ahead.</p>

                <div class="flex justify-between items-center mb-6">
                    <button id="prevMonth" class="main-button">← Previous Month</button>
                    <h3 id="currentMonthYear" class="text-2xl sm:text-3xl font-bold text-teal-800">May 2025</h3>
                    <button id="nextMonth" class="main-button">Next Month →</button>
                </div>

                <div class="flex items-center justify-center mb-6">
                    <label for="familySizeInput" class="block text-lg font-medium text-neutral-700 mr-3">Family Size:</label>
                    <input type="number" id="familySizeInput" value="4" min="1" class="w-24 p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all duration-200 text-center">
                </div>

                <div class="calendar-grid text-center font-semibold text-neutral-700 mb-4">
                    <div class="py-2">Sun</div>
                    <div class="py-2">Mon</div>
                    <div class="py-2">Tue</div>
                    <div class="py-2">Wed</div>
                    <div class="py-2">Thu</div>
                    <div class="py-2">Fri</div>
                    <div class="py-2">Sat</div>
                </div>
                <div id="calendarDays" class="calendar-grid"><div class="calendar-day bg-gray-100 text-gray-400 flex items-center justify-center"></div><div class="calendar-day bg-gray-100 text-gray-400 flex items-center justify-center"></div><div class="calendar-day bg-gray-100 text-gray-400 flex items-center justify-center"></div><div class="calendar-day bg-gray-100 text-gray-400 flex items-center justify-center"></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">1</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-01">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-01">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-01">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">2</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-02">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-02">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-02">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">3</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-03">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-03">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-03">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">4</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-04">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-04">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-04">Dinner</button><button class="grocery-list-link" data-date="2025-05-04">Grocery List</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">5</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-05">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-05">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-05">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">6</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-06">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-06">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-06">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">7</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-07">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-07">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-07">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">8</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-08">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-08">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-08">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">9</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-09">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-09">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-09">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">10</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-10">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-10">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-10">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">11</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-11">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-11">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-11">Dinner</button><button class="grocery-list-link" data-date="2025-05-11">Grocery List</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">12</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-12">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-12">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-12">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">13</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-13">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-13">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-13">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">14</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-14">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-14">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-14">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">15</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-15">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-15">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-15">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">16</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-16">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-16">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-16">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">17</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-17">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-17">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-17">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">18</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-18">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-18">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-18">Dinner</button><button class="grocery-list-link" data-date="2025-05-18">Grocery List</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">19</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-19">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-19">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-19">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">20</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-20">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-20">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-20">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">21</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-21">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-21">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-21">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">22</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-22">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-22">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-22">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">23</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-23">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-23">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-23">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">24</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-24">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-24">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-24">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">25</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-25">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-25">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-25">Dinner</button><button class="grocery-list-link" data-date="2025-05-25">Grocery List</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">26</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-26">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-26">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-26">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">27</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-27">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-27">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-27">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">28</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-28">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-28">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-28">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">29</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-29">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-29">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-29">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">30</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-30">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-30">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-30">Dinner</button></div><div class="calendar-day current-month relative p-2 rounded-lg shadow-sm flex flex-col justify-start items-center"><div class="day-number">31</div><button class="meal-slot breakfast" data-meal-type="breakfast" data-date="2025-05-31">Breakfast</button><button class="meal-slot lunch" data-meal-type="lunch" data-date="2025-05-31">Lunch</button><button class="meal-slot dinner" data-meal-type="dinner" data-date="2025-05-31">Dinner</button></div></div>
            </section>
        </main>

        <footer class="mt-16 pt-8 border-t border-gray-300 text-center text-neutral-600">
            <p class="text-sm leading-relaxed">Recipes are AI-generated and intended as suggestions. Always check ingredients for allergies and dietary needs. This is a demo application.</p>
            <p class="text-xs mt-2 text-neutral-500">© 2024 Family Recipe Calendar. All rights reserved.</p>
        </footer>
    </div>

    <div id="recipeModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="closeRecipeModal" class="close-button">×</button>
            <h3 id="modalRecipeTitle" class="text-2xl sm:text-3xl font-bold section-heading mb-4"></h3>
            
            <div class="mb-5">
                <label for="individualServingsInput" class="block text-base font-medium text-neutral-700 mb-2">Override Servings for this Recipe:</label>
                <input type="number" id="individualServingsInput" min="1" class="w-28 p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all duration-200">
                <p class="text-sm text-neutral-500 mt-1">Leave blank to use Family Size (<span id="currentFamilySizeDisplay">4</span> servings).</p>
            </div>

            <div class="flex flex-wrap gap-3 mb-5">
                <button id="healthySwapBtn" class="main-button">✨ Healthy Swap</button>
                <button id="generateNewRecipeInModalBtn" class="secondary-button">✨ Generate New Recipe</button>
                <button id="swapToCrockpotBtn" class="secondary-button bg-orange-500 hover:bg-orange-600"> slow cooker</button>
            </div>

            <div id="newRecipeSelection" class="p-4 bg-blue-50 rounded-lg border border-blue-200 hidden mb-5">
                <h5 class="font-bold text-blue-800 mb-2 text-lg">New Recipe Generated:</h5>
                <p id="newRecipeNameDisplay" class="text-blue-700 text-base mb-3"></p>
                <button id="selectNewRecipeBtn" class="secondary-button bg-blue-600 hover:bg-blue-700">Use This Recipe</button>
            </div>

            <div id="crockpotSwapSelection" class="p-4 bg-orange-50 rounded-lg border border-orange-200 hidden mb-5">
                <h5 class="font-bold text-orange-800 mb-2 text-lg">Crockpot Version Generated:</h5>
                <p id="crockpotSwapNameDisplay" class="text-orange-700 text-base mb-3 font-semibold"></p>
                <h6 class="font-bold text-orange-800 mb-1 text-sm">Ingredients:</h6>
                <ul id="crockpotSwapIngredientsDisplay" class="list-disc pl-5 text-orange-700 text-sm leading-relaxed mb-3"></ul>
                <h6 class="font-bold text-orange-800 mb-1 text-sm">Instructions:</h6>
                <div id="crockpotSwapInstructionsDisplay" class="text-orange-700 text-sm leading-relaxed mb-4"></div>
                <button id="selectCrockpotSwapBtn" class="secondary-button bg-orange-600 hover:bg-orange-700">Use This Crockpot Version</button>
            </div>

            <div id="healthySwapsDisplay" class="mt-5 p-4 bg-emerald-50 rounded-lg border border-emerald-200 hidden">
                <h5 class="font-bold text-emerald-800 mb-2 text-lg">Healthy Swap Suggestions:</h5>
                <ul id="healthySwapsList" class="list-disc pl-6 text-emerald-700 text-sm leading-relaxed">
                    </ul>
                <div class="mt-4 flex items-center">
                    <input type="checkbox" id="useHealthySwapsCheckbox" class="h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500 mr-2">
                    <label for="useHealthySwapsCheckbox" class="text-base checkbox-label font-medium">Use these swaps for grocery list</label>
                </div>
            </div>

            <div class="mt-5 flex items-center">
                <input type="checkbox" id="excludeFromGroceryListCheckbox" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500 mr-2">
                <label for="excludeFromGroceryListCheckbox" class="text-base font-medium text-red-700">Exclude from Grocery List</label>
            </div>

            <h4 class="text-xl font-bold text-neutral-700 mt-6 mb-3">Ingredients:</h4>
            <ul id="modalRecipeIngredients" class="list-disc pl-6 text-neutral-700 mb-6 leading-relaxed">
                </ul>
            <h4 class="text-xl font-bold text-neutral-700 mb-3">Instructions:</h4>
            <div id="modalRecipeInstructions" class="text-neutral-700 text-base leading-relaxed">
                </div>
        </div>
    </div>

    <div id="groceryListModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="closeGroceryListModal" class="close-button">×</button>
            <h3 class="text-2xl sm:text-3xl font-bold section-heading mb-4">Grocery List for the Week</h3>
            <div id="groceryListContent" class="text-neutral-700 text-base leading-relaxed mb-6">
                <p class="text-center text-neutral-500 flex items-center justify-center">Generating grocery list <span class="loading-spinner"></span></p>
            </div>
        </div>
    </div>

    <div id="bookmarkInfoModal" class="modal-overlay hidden">
        <div class="modal-content max-w-md">
            <button id="closeBookmarkInfoModal" class="close-button">×</button>
            <h3 class="text-xl font-bold section-heading mb-4 text-center">Bookmark This Calendar!</h3>
            <p class="text-neutral-700 text-base text-center mb-4">
                To save this calendar to your favorites or bookmarks, press:
            </p>
            <p class="text-2xl font-bold text-center text-teal-700 mb-6">
                Ctrl + D (Windows) or Command + D (Mac)
            </p>
            <p class="text-neutral-600 text-sm text-center">
                This will allow you to quickly access your personalized calendar anytime!
            </p>
        </div>
    </div>

    <div id="whatCanIMakeModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="closeWhatCanIMakeModal" class="close-button">×</button>
            <h3 class="text-2xl sm:text-3xl font-bold section-heading mb-4">✨ What Can I Make?</h3>
            <p class="text-neutral-600 mb-4">Enter the ingredients you have on hand, separated by commas or new lines, and I'll suggest some recipes!</p>
            <textarea id="whatCanIMakeIngredientsInput" rows="6" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all duration-200 mb-4" placeholder="e.g., chicken breast, rice, broccoli, soy sauce"></textarea>
            <button id="getIdeasBtn" class="main-button w-full">Get Recipe Ideas</button>
            <div id="whatCanIMakeLoading" class="text-center text-neutral-500 mt-4 hidden">
                Generating ideas <span class="loading-spinner"></span>
            </div>
            <div class="mt-6">
                <h4 class="text-xl font-bold text-neutral-700 mb-3">Suggested Recipes:</h4>
                <ul id="whatCanIMakeSuggestionsList" class="list-disc pl-6 text-neutral-700 leading-relaxed">
                    <li class="text-neutral-500">Ideas will appear here...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = ""; // Keep this empty, Canvas will provide it
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

        let currentCalendarDate = new Date(); // Start at current date
        currentCalendarDate.setDate(1); // Set to the first day of the current month

        // Global state for family size
        let familySize = 4; // Default family size

        // Store generated recipes
        const allRecipes = {}; // { recipeId: { name, ingredients, instructions, baseServings, healthySwaps, useHealthySwaps, excludeFromGroceryList, overrideServings } }
        const calendarAssignments = {}; // { 'YYYY-MM-DD': { breakfast: recipeId, lunch: recipeId, dinner: recipeId } }

        const calendarDaysEl = document.getElementById('calendarDays');
        const currentMonthYearEl = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const familySizeInput = document.getElementById('familySizeInput');

        const recipeModal = document.getElementById('recipeModal');
        const closeRecipeModalBtn = document.getElementById('closeRecipeModal');
        const modalRecipeTitle = document.getElementById('modalRecipeTitle');
        const individualServingsInput = document.getElementById('individualServingsInput');
        const currentFamilySizeDisplay = document.getElementById('currentFamilySizeDisplay');
        const modalRecipeIngredients = document.getElementById('modalRecipeIngredients');
        const modalRecipeInstructions = document.getElementById('modalRecipeInstructions');
        const healthySwapBtn = document.getElementById('healthySwapBtn');
        const healthySwapsDisplay = document.getElementById('healthySwapsDisplay');
        const healthySwapsList = document.getElementById('healthySwapsList');
        const useHealthySwapsCheckbox = document.getElementById('useHealthySwapsCheckbox');
        const generateNewRecipeInModalBtn = document.getElementById('generateNewRecipeInModalBtn');
        const newRecipeSelection = document.getElementById('newRecipeSelection');
        const newRecipeNameDisplay = document.getElementById('newRecipeNameDisplay');
        const selectNewRecipeBtn = document.getElementById('selectNewRecipeBtn');
        const excludeFromGroceryListCheckbox = document.getElementById('excludeFromGroceryListCheckbox');

        const swapToCrockpotBtn = document.getElementById('swapToCrockpotBtn');
        const crockpotSwapSelection = document.getElementById('crockpotSwapSelection');
        const crockpotSwapNameDisplay = document.getElementById('crockpotSwapNameDisplay');
        const crockpotSwapIngredientsDisplay = document.getElementById('crockpotSwapIngredientsDisplay');
        const crockpotSwapInstructionsDisplay = document.getElementById('crockpotSwapInstructionsDisplay');
        const selectCrockpotSwapBtn = document.getElementById('selectCrockpotSwapBtn');


        const groceryListModal = document.getElementById('groceryListModal');
        const closeGroceryListModalBtn = document.getElementById('closeGroceryListModal');
        const groceryListContent = document.getElementById('groceryListContent');

        // Bookmark elements
        const bookmarkCalendarBtn = document.getElementById('bookmarkCalendarBtn');
        const bookmarkInfoModal = document.getElementById('bookmarkInfoModal');
        const closeBookmarkInfoModal = document.getElementById('closeBookmarkInfoModal');

        // What Can I Make? elements
        const whatCanIMakeBtn = document.getElementById('whatCanIMakeBtn');
        const whatCanIMakeModal = document.getElementById('whatCanIMakeModal');
        const closeWhatCanIMakeModal = document.getElementById('closeWhatCanIMakeModal');
        const whatCanIMakeIngredientsInput = document.getElementById('whatCanIMakeIngredientsInput');
        const getIdeasBtn = document.getElementById('getIdeasBtn');
        const whatCanIMakeSuggestionsList = document.getElementById('whatCanIMakeSuggestionsList');
        const whatCanIMakeLoading = document.getElementById('whatCanIMakeLoading');

        let currentRecipeId = null;
        let currentMealType = null;
        let currentDateString = null;
        let tempGeneratedRecipeId = null;
        let tempCrockpotSwapRecipeId = null;
        let userProvidedIngredients = ''; // To store ingredients for the second LLM call

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function categorizeIngredient(item) {
            const lowerItem = item.toLowerCase();
            if (lowerItem.includes('milk') || lowerItem.includes('cheese') || lowerItem.includes('yogurt') || lowerItem.includes('butter') || lowerItem.includes('cream') || lowerItem.includes('eggs')) {
                return 'Dairy';
            }
            if (lowerItem.includes('chicken') || lowerItem.includes('beef') || lowerItem.includes('pork') || lowerItem.includes('fish') || lowerItem.includes('sausage') || lowerItem.includes('bacon') || lowerItem.includes('turkey') || lowerItem.includes('lamb') || lowerItem.includes('seafood')) {
                return 'Meats';
            }
            if (lowerItem.includes('apple') || lowerItem.includes('banana') || lowerItem.includes('carrot') || lowerItem.includes('onion') || lowerItem.includes('garlic') || lowerItem.includes('potato') || lowerItem.includes('tomato') || lowerItem.includes('lettuce') || lowerItem.includes('spinach') || lowerItem.includes('broccoli') || lowerItem.includes('fruit') || lowerItem.includes('vegetable') || lowerItem.includes('berry') || lowerItem.includes('citrus') || lowerItem.includes('pepper') || lowerItem.includes('cucumber') || lowerItem.includes('zucchini')) {
                return 'Produce';
            }
            if (lowerItem.includes('frozen') || lowerItem.includes('ice cream') || lowerItem.includes('frozen peas') || lowerItem.includes('frozen corn') || lowerItem.includes('frozen berries')) {
                return 'Frozen';
            }
            if (lowerItem.includes('can') || lowerItem.includes('canned') || lowerItem.includes('box') || lowerItem.includes('boxed') || lowerItem.includes('pasta') || lowerItem.includes('rice') || lowerItem.includes('flour') || lowerItem.includes('sugar') || lowerItem.includes('beans (canned)') || lowerItem.includes('soup (canned)') || lowerItem.includes('broth (boxed)')) {
                return 'Canned and Boxed';
            }
            return 'Pantry & Miscellaneous';
        }

        function renderCalendar() {
            calendarDaysEl.innerHTML = '';
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            currentMonthYearEl.textContent = currentCalendarDate.toLocaleString('en-US', { month: 'long', year: 'numeric' });

            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('calendar-day', 'bg-gray-100', 'text-gray-400', 'flex', 'items-center', 'justify-center');
                calendarDaysEl.appendChild(emptyDay);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateString = formatDate(date);

                if (!calendarAssignments[dateString]) {
                    calendarAssignments[dateString] = {
                        breakfast: null,
                        lunch: null,
                        dinner: null
                    };
                }

                const dayEl = document.createElement('div');
                dayEl.classList.add('calendar-day', 'current-month', 'relative', 'p-2', 'rounded-lg', 'shadow-sm', 'flex', 'flex-col', 'justify-start', 'items-center');

                const dayNumber = document.createElement('div');
                dayNumber.classList.add('day-number');
                dayNumber.textContent = day;
                dayEl.appendChild(dayNumber);

                const breakfastSlot = document.createElement('button');
                breakfastSlot.classList.add('meal-slot', 'breakfast');
                breakfastSlot.textContent = 'Breakfast';
                breakfastSlot.dataset.mealType = 'breakfast';
                breakfastSlot.dataset.date = dateString;
                dayEl.appendChild(breakfastSlot);

                const lunchSlot = document.createElement('button');
                lunchSlot.classList.add('meal-slot', 'lunch');
                lunchSlot.textContent = 'Lunch';
                lunchSlot.dataset.mealType = 'lunch';
                lunchSlot.dataset.date = dateString;
                dayEl.appendChild(lunchSlot);

                const dinnerSlot = document.createElement('button');
                dinnerSlot.classList.add('meal-slot', 'dinner');
                dinnerSlot.textContent = 'Dinner';
                dinnerSlot.dataset.mealType = 'dinner';
                dinnerSlot.dataset.date = dateString;
                dayEl.appendChild(dinnerSlot);

                if (date.getDay() === 0) {
                    const groceryListLink = document.createElement('button');
                    groceryListLink.classList.add('grocery-list-link');
                    groceryListLink.textContent = 'Grocery List';
                    groceryListLink.dataset.date = dateString;
                    groceryListLink.addEventListener('click', handleGroceryListClick);
                    dayEl.appendChild(groceryListLink);
                }

                dayEl.querySelectorAll('.meal-slot').forEach(slot => {
                    slot.addEventListener('click', handleMealClick);
                });

                calendarDaysEl.appendChild(dayEl);
            }
        }

        async function generateRecipe(mealType) {
            const prompt = `Generate a family-friendly, easy-to-make ${mealType} recipe for ${familySize} servings. Provide the recipe name, a list of ingredients with quantities and units, and step-by-step instructions. Respond in JSON format. Example: {"name": "Recipe Name", "ingredients": [{"item": "Ingredient 1", "quantity": 1, "unit": "cup"}], "instructions": "Step 1.\\nStep 2."}`;
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            name: { type: "STRING" },
                            ingredients: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        item: { type: "STRING" },
                                        quantity: { type: "NUMBER" },
                                        unit: { type: "STRING" }
                                    },
                                    required: ["item", "quantity"]
                                }
                            },
                            instructions: { type: "STRING" }
                        },
                        required: ["name", "ingredients", "instructions"]
                    }
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const recipeJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    const recipeId = `${mealType}-${Date.now()}`;
                    allRecipes[recipeId] = { ...recipeJson, baseServings: familySize, healthySwaps: [], useHealthySwaps: false, excludeFromGroceryList: false, overrideServings: null };
                    return recipeId;
                } else {
                    console.error('AI response structure unexpected:', result);
                    return null;
                }
            } catch (error) {
                console.error('Error generating recipe:', error);
                return null;
            }
        }

        async function generateCrockpotSwap(originalRecipeName, originalIngredients, originalInstructions) {
            const ingredientsText = originalIngredients.map(ing => `${ing.quantity} ${ing.unit || ''} ${ing.item}`).join(', ');
            const prompt = `Convert the following recipe into a family-friendly, easy-to-make crockpot/slow cooker version for ${familySize} servings. Provide the recipe name, a list of ingredients with quantities and units, and step-by-step instructions suitable for a slow cooker.

            Original Recipe Name: ${originalRecipeName}
            Original Ingredients: ${ingredientsText}
            Original Instructions: ${originalInstructions}

            Respond in JSON format. Example: {"name": "Crockpot Recipe Name", "ingredients": [{"item": "Ingredient 1", "quantity": 1, "unit": "cup"}], "instructions": "Step 1.\\nStep 2."}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            name: { type: "STRING" },
                            ingredients: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        item: { type: "STRING" },
                                        quantity: { type: "NUMBER" },
                                        unit: { type: "STRING" }
                                    },
                                    required: ["item", "quantity"]
                                }
                            },
                            instructions: { type: "STRING" }
                        },
                        required: ["name", "ingredients", "instructions"]
                    }
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const recipeJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    const recipeId = `crockpot-${Date.now()}`;
                    allRecipes[recipeId] = { ...recipeJson, baseServings: familySize, healthySwaps: [], useHealthySwaps: false, excludeFromGroceryList: false, overrideServings: null };
                    return recipeId;
                } else {
                    console.error('AI response structure unexpected for crockpot swap:', result);
                    return null;
                }
            } catch (error) {
                console.error('Error generating crockpot swap recipe:', error);
                return null;
            }
        }


        async function handleMealClick(event) {
            currentMealType = event.target.dataset.mealType;
            currentDateString = event.target.dataset.date;
            let recipeId = calendarAssignments[currentDateString][currentMealType];

            modalRecipeInstructions.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Loading recipe <span class="loading-spinner"></span></p>';
            modalRecipeIngredients.innerHTML = '';
            modalRecipeTitle.textContent = '';
            healthySwapsDisplay.classList.add('hidden');
            healthySwapsList.innerHTML = '';
            useHealthySwapsCheckbox.checked = false;
            newRecipeSelection.classList.add('hidden');
            tempGeneratedRecipeId = null;
            crockpotSwapSelection.classList.add('hidden');
            tempCrockpotSwapRecipeId = null;

            recipeModal.classList.remove('hidden');

            // Conditionally show/hide the crockpot button
            if (currentMealType === 'dinner') {
                swapToCrockpotBtn.classList.remove('hidden');
            } else {
                swapToCrockpotBtn.classList.add('hidden');
            }

            if (!recipeId) {
                recipeId = await generateRecipe(currentMealType);
                if (recipeId) {
                    calendarAssignments[currentDateString][currentMealType] = recipeId;
                } else {
                    modalRecipeTitle.textContent = 'Recipe Not Found';
                    modalRecipeInstructions.textContent = 'Could not generate recipe. Please try again.';
                    return;
                }
            }

            currentRecipeId = recipeId;
            const recipe = allRecipes[recipeId];
            modalRecipeTitle.textContent = recipe.name;
            modalRecipeInstructions.innerHTML = recipe.instructions.replace(/\n/g, '<br>');
            
            individualServingsInput.value = recipe.overrideServings !== null ? recipe.overrideServings : '';
            currentFamilySizeDisplay.textContent = familySize;

            updateRecipeServings();

            useHealthySwapsCheckbox.checked = recipe.useHealthySwaps || false;
            excludeFromGroceryListCheckbox.checked = recipe.excludeFromGroceryList || false;

            if (recipe.healthySwaps && recipe.healthySwaps.length > 0) {
                healthySwapsDisplay.classList.remove('hidden');
                healthySwapsList.innerHTML = '';
                recipe.healthySwaps.forEach(swap => {
                    const li = document.createElement('li');
                    li.textContent = `${swap.original} -> ${swap.healthy_swap}`;
                    healthySwapsList.appendChild(li);
                });
            }
        }

        function updateRecipeServings() {
            const recipe = allRecipes[currentRecipeId];
            if (!recipe) return;

            const servingsToUse = individualServingsInput.value !== '' ? parseInt(individualServingsInput.value, 10) : familySize;
            
            modalRecipeIngredients.innerHTML = '';

            recipe.ingredients.forEach(ing => {
                const li = document.createElement('li');
                const scaledQuantity = (ing.quantity / recipe.baseServings) * servingsToUse;
                li.textContent = `${scaledQuantity % 1 === 0 ? scaledQuantity : scaledQuantity.toFixed(2)} ${ing.unit || ''} ${ing.item}`;
                modalRecipeIngredients.appendChild(li);
            });
        }

        async function handleHealthySwapClick() {
            const recipe = allRecipes[currentRecipeId];
            if (!recipe) return;

            healthySwapsDisplay.classList.remove('hidden');
            healthySwapsList.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Getting suggestions <span class="loading-spinner"></span></p>';
            healthySwapBtn.disabled = true;

            const ingredientsList = recipe.ingredients.map(ing => `${ing.quantity} ${ing.unit || ''} ${ing.item}`).join(', ');
            const prompt = `For the recipe "${recipe.name}" with ingredients: ${ingredientsList}, suggest healthier ingredient swaps. Provide the original ingredient and its healthier alternative. Respond in JSON format: {"swaps": [{"original": "Original Ingredient", "healthy_swap": "Healthier Alternative"}]}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            swaps: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        original: { type: "STRING" },
                                        healthy_swap: { type: "STRING" }
                                    },
                                    required: ["original", "healthy_swap"]
                                }
                            }
                        },
                        required: ["swaps"]
                    }
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const swapJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    recipe.healthySwaps = swapJson.swaps;

                    healthySwapsList.innerHTML = '';
                    if (recipe.healthySwaps.length > 0) {
                        recipe.healthySwaps.forEach(swap => {
                            const li = document.createElement('li');
                            li.textContent = `${swap.original} -> ${swap.healthy_swap}`;
                            healthySwapsList.appendChild(li);
                        });
                    } else {
                        healthySwapsList.textContent = 'No specific healthy swaps suggested.';
                    }
                } else {
                    healthySwapsList.textContent = 'Failed to get healthy swap suggestions.';
                    console.error('AI response structure unexpected for healthy swap:', result);
                }
            } catch (error) {
                healthySwapsList.textContent = 'Error fetching healthy swap suggestions.';
                console.error('Error fetching healthy swaps:', error);
            } finally {
                healthySwapBtn.disabled = false;
            }
        }

        async function handleGenerateNewRecipeInModalClick() {
            modalRecipeInstructions.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Generating new recipe <span class="loading-spinner"></span></p>';
            modalRecipeIngredients.innerHTML = '';
            modalRecipeTitle.textContent = 'Generating...';
            individualServingsInput.value = '';
            healthySwapsDisplay.classList.add('hidden');
            healthySwapsList.innerHTML = '';
            useHealthySwapsCheckbox.checked = false;
            excludeFromGroceryListCheckbox.checked = false;
            newRecipeSelection.classList.add('hidden');
            crockpotSwapSelection.classList.add('hidden');
            generateNewRecipeInModalBtn.disabled = true;

            tempGeneratedRecipeId = await generateRecipe(currentMealType);
            if (tempGeneratedRecipeId) {
                const newRecipe = allRecipes[tempGeneratedRecipeId];
                modalRecipeTitle.textContent = newRecipe.name;
                modalRecipeInstructions.innerHTML = newRecipe.instructions.replace(/\n/g, '<br>');
                updateRecipeServingsForNewRecipe(newRecipe);

                newRecipeNameDisplay.textContent = newRecipe.name;
                newRecipeSelection.classList.remove('hidden');
            } else {
                modalRecipeTitle.textContent = 'Error Generating Recipe';
                modalRecipeInstructions.textContent = 'Could not generate a new recipe. Please try again.';
                newRecipeSelection.classList.add('hidden');
            }
            generateNewRecipeInModalBtn.disabled = false;
        }

        function updateRecipeServingsForNewRecipe(recipe) {
            const servingsToUse = individualServingsInput.value !== '' ? parseInt(individualServingsInput.value, 10) : familySize;
            modalRecipeIngredients.innerHTML = '';
            recipe.ingredients.forEach(ing => {
                const li = document.createElement('li');
                const scaledQuantity = (ing.quantity / recipe.baseServings) * servingsToUse;
                li.textContent = `${scaledQuantity % 1 === 0 ? scaledQuantity : scaledQuantity.toFixed(2)} ${ing.unit || ''} ${ing.item}`;
                modalRecipeIngredients.appendChild(li);
            });
        }

        function handleSelectNewRecipeClick() {
            if (tempGeneratedRecipeId && currentDateString && currentMealType) {
                calendarAssignments[currentDateString][currentMealType] = tempGeneratedRecipeId;
                currentRecipeId = tempGeneratedRecipeId;
                newRecipeSelection.classList.add('hidden');
                tempGeneratedRecipeId = null;
            }
        }

        async function handleSwapToCrockpotClick() {
            const originalRecipe = allRecipes[currentRecipeId];
            if (!originalRecipe) return;

            crockpotSwapInstructionsDisplay.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Generating crockpot version <span class="loading-spinner"></span></p>';
            crockpotSwapIngredientsDisplay.innerHTML = '';
            crockpotSwapNameDisplay.textContent = 'Generating...';
            swapToCrockpotBtn.disabled = true;
            newRecipeSelection.classList.add('hidden');

            tempCrockpotSwapRecipeId = await generateCrockpotSwap(originalRecipe.name, originalRecipe.ingredients, originalRecipe.instructions);

            if (tempCrockpotSwapRecipeId) {
                const crockpotRecipe = allRecipes[tempCrockpotSwapRecipeId];
                crockpotSwapNameDisplay.textContent = crockpotRecipe.name;
                crockpotSwapInstructionsDisplay.innerHTML = crockpotRecipe.instructions.replace(/\n/g, '<br>');
                
                crockpotSwapIngredientsDisplay.innerHTML = '';
                const servingsToDisplay = individualServingsInput.value !== '' ? parseInt(individualServingsInput.value, 10) : familySize;
                crockpotRecipe.ingredients.forEach(ing => {
                    const li = document.createElement('li');
                    const scaledQuantity = (ing.quantity / crockpotRecipe.baseServings) * servingsToDisplay;
                    li.textContent = `${scaledQuantity % 1 === 0 ? scaledQuantity : scaledQuantity.toFixed(2)} ${ing.unit || ''} ${ing.item}`;
                    crockpotSwapIngredientsDisplay.appendChild(li);
                });
                
                crockpotSwapSelection.classList.remove('hidden');
            } else {
                crockpotSwapNameDisplay.textContent = 'Error Generating Crockpot Recipe';
                crockpotSwapInstructionsDisplay.textContent = 'Could not generate a crockpot version. Please try again.';
                crockpotSwapSelection.classList.add('hidden');
            }
            swapToCrockpotBtn.disabled = false;
        }

        function handleSelectCrockpotSwapClick() {
            if (tempCrockpotSwapRecipeId && currentRecipeId) {
                const originalRecipe = allRecipes[currentRecipeId];
                const crockpotRecipe = allRecipes[tempCrockpotSwapRecipeId];

                if (originalRecipe && crockpotRecipe) {
                    originalRecipe.name = crockpotRecipe.name;
                    originalRecipe.ingredients = crockpotRecipe.ingredients;
                    originalRecipe.instructions = crockpotRecipe.instructions;
                    originalRecipe.baseServings = crockpotRecipe.baseServings;
                    originalRecipe.healthySwaps = [];
                    originalRecipe.useHealthySwaps = false;

                    modalRecipeTitle.textContent = originalRecipe.name;
                    modalRecipeInstructions.innerHTML = originalRecipe.instructions.replace(/\n/g, '<br>');
                    healthySwapsDisplay.classList.add('hidden');
                    healthySwapsList.innerHTML = '';
                    useHealthySwapsCheckbox.checked = false;
                    updateRecipeServings();

                    crockpotSwapSelection.classList.add('hidden');
                    tempCrockpotSwapRecipeId = null;
                }
            }
        }


        useHealthySwapsCheckbox.addEventListener('change', (event) => {
            if (currentRecipeId && allRecipes[currentRecipeId]) {
                allRecipes[currentRecipeId].useHealthySwaps = event.target.checked;
            }
        });

        excludeFromGroceryListCheckbox.addEventListener('change', (event) => {
            if (currentRecipeId && allRecipes[currentRecipeId]) {
                allRecipes[currentRecipeId].excludeFromGroceryList = event.target.checked;
            }
        });

        individualServingsInput.addEventListener('input', () => {
            if (currentRecipeId && allRecipes[currentRecipeId]) {
                allRecipes[currentRecipeId].overrideServings = individualServingsInput.value !== '' ? parseInt(individualServingsInput.value, 10) : null;
                updateRecipeServings();
            }
        });

        familySizeInput.addEventListener('input', (event) => {
            const newFamilySize = parseInt(event.target.value, 10);
            if (!isNaN(newFamilySize) && newFamilySize > 0) {
                familySize = newFamilySize;
                currentFamilySizeDisplay.textContent = familySize;
            } else if (event.target.value === '') {
                // Keep the current family size if input is empty, effectively no change
            }
        });


        async function handleGroceryListClick(event) {
            const sundayDateString = event.target.dataset.date;
            const sundayDate = new Date(sundayDateString);
            const categorizedGroceryList = {
                'Produce': [],
                'Dairy': [],
                'Meats': [],
                'Frozen': [],
                'Canned and Boxed': [],
                'Pantry & Miscellaneous': []
            };

            groceryListContent.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Generating grocery list <span class="loading-spinner"></span></p>';
            groceryListModal.classList.remove('hidden');

            for (let i = 1; i <= 7; i++) {
                const date = new Date(sundayDate);
                date.setDate(sundayDate.getDate() + i);
                const dateString = formatDate(date);

                const mealsForDay = calendarAssignments[dateString];
                if (mealsForDay) {
                    for (const mealType of ['breakfast', 'lunch', 'dinner']) {
                        let recipeId = mealsForDay[mealType];
                        if (!recipeId) {
                            recipeId = await generateRecipe(mealType);
                            if (recipeId) {
                                calendarAssignments[dateString][mealType] = recipeId;
                            } else {
                                console.warn(`Could not generate recipe for ${mealType} on ${dateString} for grocery list.`);
                                continue;
                            }
                        }

                        const recipe = allRecipes[recipeId];
                        if (recipe && !recipe.excludeFromGroceryList) {
                            const ingredientsSource = (recipe.useHealthySwaps && recipe.healthySwaps && recipe.healthySwaps.length > 0)
                                ? recipe.healthySwaps.map(swap => ({ item: swap.healthy_swap, quantity: 1, unit: '' }))
                                : recipe.ingredients;

                            const servingsForGrocery = recipe.overrideServings !== null ? recipe.overrideServings : familySize;

                            ingredientsSource.forEach(ing => {
                                const scaledQuantity = (ing.quantity / recipe.baseServings) * servingsForGrocery;
                                const category = categorizeIngredient(ing.item);
                                
                                const existingItemIndex = categorizedGroceryList[category].findIndex(item => item.item === ing.item && item.unit === ing.unit);

                                if (existingItemIndex > -1) {
                                    categorizedGroceryList[category][existingItemIndex].quantity += scaledQuantity;
                                } else {
                                    categorizedGroceryList[category].push({ item: ing.item, quantity: scaledQuantity, unit: ing.unit || '' });
                                }
                            });
                        }
                    }
                }
            }

            groceryListContent.innerHTML = '';
            let hasItems = false;

            for (const category of Object.keys(categorizedGroceryList)) {
                const items = categorizedGroceryList[category];
                if (items.length > 0) {
                    hasItems = true;
                    const categoryHeading = document.createElement('h4');
                    categoryHeading.classList.add('category-heading');
                    categoryHeading.textContent = category;
                    groceryListContent.appendChild(categoryHeading);

                    const ul = document.createElement('ul');
                    ul.classList.add('list-disc', 'pl-5', 'mb-4');

                    items.sort((a, b) => a.item.localeCompare(b.item));

                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.quantity % 1 === 0 ? item.quantity : item.quantity.toFixed(2)} ${item.unit} ${item.item}`;
                        ul.appendChild(li);
                    });
                    groceryListContent.appendChild(ul);
                }
            }

            if (!hasItems) {
                groceryListContent.innerHTML = '<p class="text-center text-neutral-500">No recipes found for the upcoming week to generate a grocery list or all recipes were excluded.</p>';
            }
        }

        prevMonthBtn.addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        });

        healthySwapBtn.addEventListener('click', handleHealthySwapClick);
        generateNewRecipeInModalBtn.addEventListener('click', handleGenerateNewRecipeInModalClick);
        selectNewRecipeBtn.addEventListener('click', handleSelectNewRecipeClick);
        
        swapToCrockpotBtn.addEventListener('click', handleSwapToCrockpotClick);
        selectCrockpotSwapBtn.addEventListener('click', handleSelectCrockpotSwapClick);


        closeRecipeModalBtn.addEventListener('click', () => {
            recipeModal.classList.add('hidden');
            healthySwapsDisplay.classList.add('hidden');
            healthySwapsList.innerHTML = '';
            newRecipeSelection.classList.add('hidden');
            tempGeneratedRecipeId = null;
            crockpotSwapSelection.classList.add('hidden');
            tempCrockpotSwapRecipeId = null;
        });

        closeGroceryListModalBtn.addEventListener('click', () => {
            groceryListModal.classList.add('hidden');
        });

        // Event listener for bookmark button
        bookmarkCalendarBtn.addEventListener('click', () => {
            bookmarkInfoModal.classList.remove('hidden');
        });

        // Event listener for closing bookmark info modal
        closeBookmarkInfoModal.addEventListener('click', () => {
            bookmarkInfoModal.classList.add('hidden');
        });

        // What Can I Make? event listeners
        whatCanIMakeBtn.addEventListener('click', () => {
            whatCanIMakeModal.classList.remove('hidden');
            whatCanIMakeIngredientsInput.value = ''; // Clear previous input
            whatCanIMakeSuggestionsList.innerHTML = '<li class="text-neutral-500">Ideas will appear here...</li>'; // Reset suggestions
            whatCanIMakeLoading.classList.add('hidden'); // Hide loading spinner
        });

        closeWhatCanIMakeModal.addEventListener('click', () => {
            whatCanIMakeModal.classList.add('hidden');
        });

        getIdeasBtn.addEventListener('click', async () => {
            userProvidedIngredients = whatCanIMakeIngredientsInput.value.trim();
            if (!userProvidedIngredients) {
                whatCanIMakeSuggestionsList.innerHTML = '<li class="text-red-500">Please enter some ingredients.</li>';
                return;
            }

            whatCanIMakeSuggestionsList.innerHTML = ''; // Clear previous suggestions
            whatCanIMakeLoading.classList.remove('hidden'); // Show loading spinner

            const prompt = `Generate 3-5 simple, family-friendly recipe names that can be made with these ingredients: ${userProvidedIngredients}. Focus on recipes that primarily use these ingredients. Respond in JSON format: {"recipe_names": ["Recipe Name 1", "Recipe Name 2", "Recipe Name 3"]}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            recipe_names: {
                                type: "ARRAY",
                                items: { type: "STRING" }
                            }
                        },
                        required: ["recipe_names"]
                    }
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const suggestionsJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    whatCanIMakeSuggestionsList.innerHTML = ''; // Clear "Ideas will appear here..."

                    if (suggestionsJson.recipe_names && suggestionsJson.recipe_names.length > 0) {
                        suggestionsJson.recipe_names.forEach(recipeName => {
                            const li = document.createElement('li');
                            li.classList.add('cursor-pointer', 'hover:text-teal-700', 'font-medium', 'my-2');
                            li.textContent = recipeName;
                            li.dataset.recipeName = recipeName;
                            li.addEventListener('click', handleSuggestedRecipeNameClick);
                            whatCanIMakeSuggestionsList.appendChild(li);
                        });
                    } else {
                        whatCanIMakeSuggestionsList.innerHTML = '<li class="text-neutral-500">No recipe ideas found with these ingredients. Try adding more!</li>';
                    }
                } else {
                    whatCanIMakeSuggestionsList.innerHTML = '<li class="text-red-500">Failed to get recipe ideas. Please try again.</li>';
                    console.error('AI response structure unexpected for recipe ideas:', result);
                }
            } catch (error) {
                whatCanIMakeSuggestionsList.innerHTML = '<li class="text-red-500">Error fetching recipe ideas. Please try again.</li>';
                console.error('Error fetching recipe ideas:', error);
            } finally {
                whatCanIMakeLoading.classList.add('hidden'); // Hide loading spinner
            }
        });

        async function handleSuggestedRecipeNameClick(event) {
            const recipeName = event.target.dataset.recipeName;
            
            whatCanIMakeModal.classList.add('hidden'); // Close the ideas modal
            recipeModal.classList.remove('hidden'); // Open the main recipe modal

            modalRecipeInstructions.innerHTML = '<p class="text-center text-neutral-500 flex items-center justify-center">Generating full recipe <span class="loading-spinner"></span></p>';
            modalRecipeIngredients.innerHTML = '';
            modalRecipeTitle.textContent = 'Generating...';
            individualServingsInput.value = '';
            healthySwapsDisplay.classList.add('hidden');
            healthySwapsList.innerHTML = '';
            useHealthySwapsCheckbox.checked = false;
            newRecipeSelection.classList.add('hidden');
            crockpotSwapSelection.classList.add('hidden');
            swapToCrockpotBtn.classList.add('hidden'); // Hide crockpot button for generated recipes

            const prompt = `Generate the full recipe for "${recipeName}" for ${familySize} servings. Primarily use the following ingredients: ${userProvidedIngredients}. If additional common pantry staples are needed (e.g., salt, pepper, oil), include them. Provide the recipe name, a list of ingredients with quantities and units, and step-by-step instructions. Respond in JSON format: {"name": "Recipe Name", "ingredients": [{"item": "Ingredient 1", "quantity": 1, "unit": "cup"}], "instructions": "Step 1.\\nStep 2."}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            name: { type: "STRING" },
                            ingredients: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        item: { type: "STRING" },
                                        quantity: { type: "NUMBER" },
                                        unit: { type: "STRING" }
                                    },
                                    required: ["item", "quantity"]
                                }
                            },
                            instructions: { type: "STRING" }
                        },
                        required: ["name", "ingredients", "instructions"]
                    }
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const recipeJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    const newRecipeId = `generated-${Date.now()}`;
                    // Store the generated recipe. Base servings will be current family size.
                    allRecipes[newRecipeId] = { ...recipeJson, baseServings: familySize, healthySwaps: [], useHealthySwaps: false, excludeFromGroceryList: false, overrideServings: null };
                    currentRecipeId = newRecipeId; // Set this as the current recipe in the modal

                    modalRecipeTitle.textContent = recipeJson.name;
                    modalRecipeInstructions.innerHTML = recipeJson.instructions.replace(/\n/g, '<br>');
                    updateRecipeServings(); // Display ingredients based on current settings
                } else {
                    modalRecipeTitle.textContent = 'Recipe Generation Failed';
                    modalRecipeInstructions.textContent = 'Could not generate the full recipe. Please try again.';
                    console.error('AI response structure unexpected for full recipe:', result);
                }
            } catch (error) {
                modalRecipeTitle.textContent = 'Error Generating Recipe';
                modalRecipeInstructions.textContent = 'Error fetching the full recipe. Please try again.';
                console.error('Error fetching full recipe:', error);
            }
        }


        // Initial render
        renderCalendar();
        familySizeInput.value = familySize;
        currentFamilySizeDisplay.textContent = familySize;
    </script>


</body></html>